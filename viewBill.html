<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View Bill - Elegets Electronics</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3f37c9;
      --dark: #0c0e1c;
      --dark-light: #1a1d2e;
      --bg-input: #2d3748; 
      --text-main: #ffffff;
      --text-label: #4cc9f0;
      --border-color: #4a5568;
    }
    
    body { 
      background-color: var(--dark); 
      color: var(--text-main); 
      font-family: 'Inter', sans-serif; 
    }

    .card { 
      background-color: var(--dark-light); 
      border: 1px solid var(--border-color);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .form-control, .form-control[readonly] { 
      background-color: var(--bg-input) !important; 
      border: 1px solid #566478 !important; 
      color: #ffffff !important; 
      font-weight: 500;
      opacity: 1 !important;
    }
    
    .form-control:focus {
        border-color: var(--primary) !important;
        box-shadow: 0 0 0 0.2rem rgba(67, 97, 238, 0.25);
    }

    .form-label-custom {
        color: var(--text-label);
        font-weight: 700;
        font-size: 0.85rem;
        margin-bottom: 5px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .input-group-text {
      background-color: var(--primary) !important;
      color: white !important;
      border: 1px solid var(--primary) !important;
    }

    /* --- TABLE VISIBILITY FIX --- */
    .table { 
        color: #ffffff !important; 
        vertical-align: middle; 
    }
    
    .table thead th { 
        background-color: var(--primary); 
        color: #ffffff !important;
        border: none; 
        padding-top: 12px; 
        padding-bottom: 12px;
        font-weight: 700;
        text-transform: uppercase;
    }
    
    .table tbody td { 
        border-bottom: 1px solid var(--border-color); 
        color: #131212 !important; 
        font-size: 1rem;
        padding-top: 12px; 
        padding-bottom: 12px;
    }

    .company-info { 
      background: rgba(67, 97, 238, 0.1); 
      border-left: 5px solid var(--primary); 
      padding: 1.5rem; 
      border-radius: 4px;
    }

    .company-info .address-line {
        color: #e2e8f0 !important;
        font-size: 0.95rem;
        margin-bottom: 0;
        opacity: 0.9;
    }

    .totals-box {
        background-color: rgba(0,0,0,0.3);
        padding: 1.5rem;
        border-radius: 0.5rem;
        border: 1px solid var(--primary);
        color: #ffffff;
    }

    .totals-label { color: #a0aec0; font-weight: 500; }
    .totals-value { color: #ffffff; font-weight: bold; }

    .hidden-search { display: none !important; }
  </style>
</head>
<body>

  <nav class="navbar navbar-dark bg-dark-light border-bottom border-secondary">
    <div class="container-fluid">
      <span class="navbar-brand fw-bold"><i class="fas fa-microchip text-primary me-2"></i> Elegets</span>
    </div>
  </nav>

  <div class="container my-5">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        
        <div id="searchContainer" class="card mb-4">
          <div class="card-body">
             <div class="input-group">
                <span class="input-group-text">ELE</span>
                <input type="text" id="billNumberInput" class="form-control" placeholder="Search Bill Number..." disabled>
                <button class="btn btn-primary" id="fetchBillBtn" disabled>Locked</button>
             </div>
          </div>
        </div>

        <div id="errorMessage" class="alert alert-danger" style="display: none;"></div>

        <div id="billDisplay" style="display: none;">
          <div class="card">
            <div class="card-body p-4 p-md-5">
              
              <div class="company-info mb-5 d-flex flex-wrap justify-content-between align-items-center">
                <div>
                  <h3 class="text-white fw-bold mb-1">Elegets Electronics</h3>
                  <p class="address-line"><i class="fas fa-map-marker-alt me-2 text-primary"></i> GMRIT College, Rajam, AP - 532127</p>
                </div>
                <div class="text-end mt-3 mt-md-0">
                  <div class="h4 text-info fw-bold mb-0" id="billNoDisplay">--</div>
                  <div class="text-muted" id="billDateDisplay" style="color: #cbd5e0 !important;">--</div>
                </div>
              </div>

              <h5 class="text-white border-bottom border-secondary pb-2 mb-3">Customer Details</h5>
              <div class="row g-3 mb-4">
                <div class="col-md-4">
                  <label class="form-label-custom">Name</label>
                  <input type="text" id="customerName" class="form-control" readonly>
                </div>
                <div class="col-md-4">
                  <label class="form-label-custom">Phone</label>
                  <input type="text" id="customerPhone" class="form-control" readonly>
                </div>
                <div class="col-md-4">
                  <label class="form-label-custom">Email</label>
                  <input type="text" id="customerEmail" class="form-control" readonly>
                </div>
                <div class="col-md-6">
                  <label class="form-label-custom">Address</label>
                  <input type="text" id="customerAddress" class="form-control" readonly>
                </div>
                <div class="col-md-3">
                  <label class="form-label-custom">City</label>
                  <input type="text" id="customerCity" class="form-control" readonly>
                </div>
                <div class="col-md-3">
                  <label class="form-label-custom">Pincode</label>
                  <input type="text" id="customerPincode" class="form-control" readonly>
                </div>
              </div>

              <div class="table-responsive mb-4">
                <table class="table">
                  <thead>
                    <tr>
                      <th class="ps-3">Product</th>
                      <th class="text-end">Price</th>
                      <th class="text-center">Qty</th>
                      <th class="text-end pe-3">Total</th>
                    </tr>
                  </thead>
                  <tbody id="billItems"></tbody>
                </table>
              </div>

              <div class="row mt-4">
                <div class="col-md-7 mb-3">
                   <label class="form-label-custom">Notes</label>
                   <div id="additionalNotes" class="p-3 rounded bg-input border border-secondary" style="min-height: 100px; color: #ffffff;"></div>
                </div>
                <div class="col-md-5">
                   <div class="totals-box">
                      <div class="d-flex justify-content-between mb-2">
                        <span class="totals-label">Subtotal</span>
                        <span class="totals-value">₹<span id="subtotal">0</span></span>
                      </div>
                      <div class="d-flex justify-content-between mb-2">
                        <span class="text-danger fw-bold">Discount</span>
                        <span class="text-danger fw-bold">-₹<span id="discountDisplay">0</span></span>
                      </div>
                      <div class="d-flex justify-content-between mb-3">
                        <span class="text-success fw-bold">Delivery</span>
                        <span class="text-success fw-bold">+₹<span id="deliveryDisplay">0</span></span>
                      </div>
                      <div class="d-flex justify-content-between h5 border-top border-secondary pt-3 fw-bold text-info">
                        <span>Grand Total</span>
                        <span>₹<span id="grandTotal">0</span></span>
                      </div>
                   </div>
                </div>
              </div>

              <div class="text-end mt-4">
                <button class="btn btn-primary btn-lg" id="downloadBillBtn">
                  <i class="fas fa-file-pdf me-2"></i> Download Invoice
                </button>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    const supabaseUrl = 'https://oborglvlgafnglzqczot.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ib3JnbHZsZ2FmbmdsenFjem90Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MjE2MzEsImV4cCI6MjA2ODQ5NzYzMX0.dDt-_pcuEcyuvBlNvpMCspPXW04AU-KeFjIpQcWXXXk';
    const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);

    // Global variable to store fetched data for PDF generation
    let currentBillData = null;

    document.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const billId = urlParams.get('bill');

      if (billId) {
        document.getElementById('searchContainer').classList.add('hidden-search');
        fetchBill(billId);
      } else {
        document.getElementById('errorMessage').style.display = 'block';
        document.getElementById('errorMessage').textContent = "No bill ID provided in the link.";
      }

      document.getElementById('downloadBillBtn').addEventListener('click', generatePDF);
    });

    async function fetchBill(id) {
      let searchId = id.toUpperCase().startsWith('ELE') ? id.toUpperCase() : 'ELE' + id.padStart(3, '0');
      
      try {
        const { data, error } = await supabaseClient
          .from('bills')
          .select('*')
          .eq('bill_number', searchId)
          .single();
        
        if (error || !data) throw new Error("Not found");
        
        // STORE DATA GLOBALLY
        currentBillData = data;

        renderData(data);
        document.getElementById('billDisplay').style.display = 'block';
      } catch (err) {
        console.error(err);
        document.getElementById('errorMessage').style.display = 'block';
        document.getElementById('errorMessage').textContent = "Invoice " + searchId + " not found.";
      }
    }

    function renderData(bill) {
      document.getElementById('billNoDisplay').textContent = bill.bill_number;
      document.getElementById('billDateDisplay').textContent = new Date(bill.bill_date).toDateString();
      
      document.getElementById('customerName').value = bill.customer?.name || '';
      document.getElementById('customerPhone').value = bill.customer?.phone || '';
      document.getElementById('customerEmail').value = bill.customer?.email || '';
      document.getElementById('customerAddress').value = bill.customer?.address || '';
      document.getElementById('customerCity').value = bill.customer?.city || '';
      document.getElementById('customerPincode').value = bill.customer?.pincode || '';

      document.getElementById('additionalNotes').textContent = bill.notes || 'No extra notes.';

      const tbody = document.getElementById('billItems');
      tbody.innerHTML = (bill.items || []).map(item => `
        <tr>
          <td class="ps-3 fw-bold">${item.name}</td>
          <td class="text-end">₹${item.price}</td>
          <td class="text-center">${item.qty}</td>
          <td class="text-end pe-3 fw-bold text-info">₹${item.total}</td>
        </tr>
      `).join('');

      document.getElementById('subtotal').textContent = bill.subtotal;
      document.getElementById('discountDisplay').textContent = bill.discount;
      document.getElementById('deliveryDisplay').textContent = bill.delivery_charges;
      document.getElementById('grandTotal').textContent = bill.grand_total;
    }

    async function generatePDF() {
        if (!currentBillData) {
            alert("No data available to generate PDF");
            return;
        }

        // Colorful company details
        const companyDetails = {
            name: "ELEGETS ELECTRONICS",
            address: "Flat No: 102, Vishaka Valley Heights1, Veterinary Colony Opp MRO Office",
            city: "Visakhapatnam, Andhra Pradesh - 530040",
            website: "www.gostore.app/elegets",
            contactNumber: "+91 63020 85024",
            email: "contact.elegets@gmail.com",
            GSTIN: "36CAUPP0582Q1ZN",
            tagline: "Premium Electronics & Gadgets",
            established: "Est. 2023",
            colors: {
                primary: "#4361ee",
                secondary: "#3a56d4",
                accent: "#7209b7",
                success: "#38a169",
                warning: "#d69e2e",
                danger: "#e53e3e",
                lightBg: "#f8fafc"
            }
        };

        // Gather bill data from GLOBAL STORAGE (currentBillData) 
        // because input fields might be missing in view-only mode
        const invoiceNumber = currentBillData.bill_number;
        const invoiceDate = new Date(currentBillData.bill_date);
        const paymentMethod = currentBillData.payment_mode || 'Online/UPI'; 
        
        const customerName = currentBillData.customer?.name || '';
        const customerPhone = currentBillData.customer?.phone || '';
        const customerEmail = currentBillData.customer?.email || '';
        const customerAddress = currentBillData.customer?.address || '';
        const customerCity = currentBillData.customer?.city || '';
        const customerPincode = currentBillData.customer?.pincode || '';
        const notes = currentBillData.notes || '';
        
        const subtotal = parseFloat(currentBillData.subtotal || 0);
        const discount = parseFloat(currentBillData.discount || 0);
        const delivery = parseFloat(currentBillData.delivery_charges || 0);
        const grandTotal = parseFloat(currentBillData.grand_total || 0);
        
        // Assuming paid = grandTotal for view-only invoices unless specified
        const paid = grandTotal; 
        const balance = 0; 

        const bill = currentBillData.items || [];

        // Create PDF container with compact professional styling
        const pdfContainer = document.createElement('div');
        pdfContainer.style.width = '210mm';
        pdfContainer.style.minHeight = '297mm';
        pdfContainer.style.padding = '0';
        pdfContainer.style.fontFamily = "'Poppins', 'Helvetica Neue', Arial, sans-serif";
        pdfContainer.style.color = '#2d3748';
        pdfContainer.style.background = '#fff';
        pdfContainer.style.lineHeight = '1.4';
        
        // Generate the HTML content
        pdfContainer.innerHTML = `
            <style>
                @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Fredoka+One&display=swap');
                
                .colorful-invoice {
                    width: 100%;
                    max-width: 800px;
                    margin: 0 auto;
                    background: #fff;
                    position: relative;
                    overflow: hidden;
                    padding-bottom: 10px;
                }
                
                .invoice-header {
                    background: linear-gradient(135deg, ${companyDetails.colors.primary} 0%, ${companyDetails.colors.secondary} 100%);
                    padding: 8px 12px;
                    color: white;
                    position: relative;
                    overflow: hidden;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    border-bottom: 3px solid ${companyDetails.colors.accent};
                }
                
                .company-info { flex: 1; }
                
                .company-name {
                    font-family: 'Fredoka One', cursive;
                    font-weight: 400;
                    font-size: 20px;
                    letter-spacing: 0.5px;
                    margin-bottom: 0px;
                }
                
                .company-details {
                    font-size: 9px;
                    opacity: 0.9;
                    line-height: 1.2;
                }
                
                .invoice-title { text-align: right; }
                
                .invoice-title-text {
                    font-family: 'Poppins', sans-serif;
                    font-weight: 700;
                    font-size: 22px;
                    color: white;
                    margin: 0;
                    line-height: 1;
                    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
                }
                
                .invoice-number {
                    font-size: 12px;
                    font-weight: 500;
                    margin-top: 2px;
                    opacity: 0.9;
                }
                
                .invoice-content { padding: 10px 12px; }

                .columns {
                    display: flex;
                    margin-bottom: 10px;
                    gap: 10px;
                }
                
                .column {
                    flex: 1;
                    background: ${companyDetails.colors.lightBg};
                    border-radius: 6px;
                    padding: 8px 10px;
                    border-left: 3px solid ${companyDetails.colors.primary};
                    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
                }
                
                .section-title {
                    font-family: 'Poppins', sans-serif;
                    font-weight: 600;
                    font-size: 12px;
                    color: ${companyDetails.colors.primary};
                    margin-bottom: 6px;
                    display: flex;
                    align-items: center;
                    padding-bottom: 3px;
                    border-bottom: 1px dashed #e2e8f0;
                }
                
                .section-title:before {
                    content: '';
                    display: inline-block;
                    width: 5px;
                    height: 5px;
                    border-radius: 50%;
                    background: ${companyDetails.colors.accent};
                    margin-right: 6px;
                }
                
                .info-grid {
                    display: grid;
                    grid-template-columns: 70px 1fr;
                    gap: 2px;
                    font-size: 11px;
                }
                
                .info-label { color: #718096; font-weight: 500; }
                .info-value { color: #2d3748; word-break: break-word; }
                
                .items-table {
                    width: 100%;
                    border-collapse: collapse;
                    margin: 10px 0;
                    font-size: 11px;
                    border-radius: 6px;
                    overflow: hidden;
                    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
                }
                
                .items-table thead th {
                    background: ${companyDetails.colors.primary};
                    color: white;
                    padding: 6px 8px;
                    text-align: left;
                    font-weight: 600;
                    font-size: 11px;
                }
                
                .items-table tbody td {
                    padding: 4px 8px;
                    border-bottom: 1px solid #edf2f7;
                    color: #4a5568;
                    background: white;
                }
                
                .items-table tbody tr:nth-child(even) td {
                    background: ${companyDetails.colors.lightBg};
                }
                
                .text-right { text-align: right; }
                .text-center { text-align: center; }
                
                .summary-section {
                    display: flex;
                    justify-content: flex-end;
                    margin-top: 10px;
                }
                
                .summary {
                    width: 220px;
                    background: white;
                    border-radius: 6px;
                    padding: 10px;
                    border: 1px solid #e2e8f0;
                    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
                }
                
                .summary-row {
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 4px;
                    font-size: 11px;
                }
                
                .summary-label { color: #718096; }
                .summary-value { color: #2d3748; font-weight: 500; }
                
                .summary-divider {
                    height: 1px;
                    background: #e2e8f0;
                    margin: 6px 0;
                }
                
                .summary-total {
                    font-weight: 700;
                    color: ${companyDetails.colors.primary};
                    font-size: 12px;
                }
                
                .summary-balance {
                    font-weight: 700;
                    color: ${balance <= 0 ? companyDetails.colors.success : companyDetails.colors.danger};
                    font-size: 12px;
                }
                
                .payment-status {
                    display: inline-block;
                    padding: 2px 8px;
                    border-radius: 10px;
                    font-size: 9px;
                    font-weight: 600;
                    background: ${balance <= 0 ? companyDetails.colors.success : companyDetails.colors.danger};
                    color: white;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                }
                
                .notes-section {
                    margin-top: 10px;
                    padding: 8px 12px;
                    background: ${companyDetails.colors.lightBg};
                    border-radius: 6px;
                    border-left: 3px solid ${companyDetails.colors.accent};
                    font-size: 10px;
                }
                
                .notes-title {
                    font-family: 'Poppins', sans-serif;
                    font-weight: 600;
                    font-size: 11px;
                    color: ${companyDetails.colors.primary};
                    margin-bottom: 4px;
                    display: flex;
                    align-items: center;
                }
                
                .notes-title:before {
                    content: '•';
                    color: ${companyDetails.colors.accent};
                    margin-right: 6px;
                    font-size: 14px;
                }

                .notes-content ul li {
                    margin-bottom: 2px;
                    line-height: 1.3;
                }
                
                .invoice-footer {
                    margin-top: 12px;
                    padding-top: 8px;
                    border-top: 1px dashed #cbd5e0;
                    text-align: center;
                    font-size: 9px;
                    color: #a0aec0;
                }
                
                .thank-you {
                    font-family: 'Poppins', sans-serif;
                    font-weight: 500;
                    color: ${companyDetails.colors.primary};
                    margin-top: 10px;
                    text-align: center;
                    font-size: 11px;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                }
                
                .mt-10 { margin-top: 5px; }
                .mb-5 { margin-bottom: 2px; }
            </style>
            
            <div class="colorful-invoice">
                <div class="invoice-header">
                    <div class="company-info">
                        <div class="company-name">${companyDetails.name}</div>
                        <div class="company-details">
                            ${companyDetails.address}<br>
                            ${companyDetails.city}<br>
                            ${companyDetails.contactNumber} | ${companyDetails.email}
                        </div>
                    </div>
                    <div class="invoice-title">
                        <div class="invoice-title-text">INVOICE</div>
                        <div class="invoice-number">#${invoiceNumber}</div>
                        <div class="payment-status mt-10">${balance <= 0 ? 'PAID' : 'PENDING'}</div>
                    </div>
                </div>
                
                <div class="invoice-content">
                    <div class="columns">
                        <div class="column">
                            <div class="section-title">Bill To</div>
                            <div class="info-grid">
                                <div class="info-label">Name</div>
                                <div class="info-value"><strong>${customerName}</strong></div>
                                
                                ${customerAddress ? `
                                    <div class="info-label">Address</div>
                                    <div class="info-value">${customerAddress}</div>
                                ` : ''}
                                
                                <div class="info-label">City/Pin</div>
                                <div class="info-value">${customerCity}${customerPincode ? ` - ${customerPincode}` : ''}</div>
                                
                                ${customerPhone ? `
                                    <div class="info-label">Contact</div>
                                    <div class="info-value">${customerPhone}</div>
                                ` : ''}
                                
                                ${customerEmail ? `
                                    <div class="info-label">Email</div>
                                    <div class="info-value">${customerEmail}</div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div class="column">
                            <div class="section-title">Invoice Details</div>
                            <div class="info-grid">
                                <div class="info-label">Date</div>
                                <div class="info-value">${invoiceDate.toLocaleDateString('en-IN')}</div>
                                
                                <div class="info-label">Pay Mode</div>
                                <div class="info-value"><strong>${paymentMethod}</strong></div>
                                
                                <div class="info-label">GSTIN</div>
                                <div class="info-value">${companyDetails.GSTIN}</div>
                                
                                <div class="info-label">Status</div>
                                <div class="info-value">
                                    <span class="payment-status">${balance <= 0 ? 'Paid' : 'Due'}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <table class="items-table">
                        <thead>
                            <tr>
                                <th>Item Description</th>
                                <th class="text-right">Price</th>
                                <th class="text-center">Qty</th>
                                <th class="text-right">Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${bill.map((item, index) => `
                                <tr>
                                    <td>${item.name}</td>
                                    <td class="text-right">₹${item.price}</td>
                                    <td class="text-center">${item.qty}</td>
                                    <td class="text-right">₹${item.total}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="summary-section">
                        <div class="summary">
                            <div class="summary-row">
                                <span class="summary-label">Subtotal:</span>
                                <span class="summary-value">₹${subtotal.toFixed(2)}</span>
                            </div>
                            
                            ${discount > 0 ? `
                                <div class="summary-row">
                                    <span class="summary-label">Discount:</span>
                                    <span class="summary-value" style="color: ${companyDetails.colors.danger}">- ₹${discount.toFixed(2)}</span>
                                </div>
                            ` : ''}
                            
                            ${delivery > 0 ? `
                                <div class="summary-row">
                                    <span class="summary-label">Delivery:</span>
                                    <span class="summary-value" style="color: ${companyDetails.colors.success}">+ ₹${delivery.toFixed(2)}</span>
                                </div>
                            ` : ''}
                            
                            <div class="summary-divider"></div>
                            
                            <div class="summary-row">
                                <span class="summary-total">Grand Total:</span>
                                <span class="summary-total">₹${grandTotal.toFixed(2)}</span>
                            </div>
                            
                            <div class="summary-row">
                                <span class="summary-label">Amount Paid:</span>
                                <span class="summary-value">₹${paid.toFixed(2)}</span>
                            </div>
                            
                            <div class="summary-divider"></div>
                            
                            <div class="summary-row">
                                <span class="summary-total">Balance:</span>
                                <span class="summary-balance">₹${Math.abs(balance).toFixed(2)} ${balance <= 0 ? 'Paid' : 'Due'}</span>
                            </div>
                        </div>
                    </div>
                    
                    ${notes ? `
                        <div class="notes-section">
                            <div class="notes-title">Customer Notes</div>
                            <div class="notes-content">
                                ${notes}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="notes-section mt-10">
                        <div class="notes-title">Terms & Conditions</div>
                        <div class="notes-content">
                            <ul style="margin: 2px 0; padding-left: 15px; list-style-type: none;">
                                <li>All components supplied by Elegets Electronics are tested for basic working condition before handover.</li>
                                <li>The customer must check the components at the time of delivery or collection.</li>
                                <li>No return, replacement, or refund is allowed once the components are accepted.</li>
                                <li>Elegets Electronics is not responsible for damage caused by wrong connections, over-voltage, reverse polarity, static discharge, or improper handling after delivery.</li>
                                <li>Software support, coding, or project assistance is not included unless clearly mentioned in the invoice.</li>
                                <li>By signing below, the customer confirms receipt of components in good condition and agrees to these terms and conditions.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="thank-you">
                        Thank you for your business!
                    </div>
                    
                    <div class="invoice-footer">
                        <div><strong>${companyDetails.name}</strong> | ${companyDetails.website} | ${companyDetails.contactNumber}</div>
                        <div class="mt-5">GSTIN: ${companyDetails.GSTIN} | ${companyDetails.established}</div>
                    </div>
                </div>
            </div>
        `;

        // Add to document
        document.body.appendChild(pdfContainer);
        
        // Initialize jsPDF with improved settings
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({
            orientation: 'portrait',
            unit: 'mm',
            format: 'a4',
            filters: ['ASCIIHexEncode'],
            putOnlyUsedFonts: true,
            compress: true
        });

        // Set PDF properties
        doc.setProperties({
            title: `Invoice ${invoiceNumber}`,
            subject: 'Invoice from Elegets Electronics',
            author: 'Elegets Electronics',
            keywords: 'invoice, bill, receipt, electronics',
            creator: 'Elegets Billing System'
        });

        // Generate canvas with improved quality
        const canvas = await html2canvas(pdfContainer, {
            scale: 2,
            logging: false,
            useCORS: true,
            allowTaint: true,
            letterRendering: true,
            backgroundColor: '#ffffff'
        });

        const imgData = canvas.toDataURL('image/png', 1.0);
        const imgWidth = doc.internal.pageSize.getWidth() - 20;
        const pageHeight = doc.internal.pageSize.getHeight();
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        
        // Calculate how many pages we need
        let heightLeft = imgHeight;
        let position = 10;
        
        // Add first page
        doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight, undefined, 'FAST');
        heightLeft -= pageHeight;
        
        // Add new pages as needed
        while (heightLeft >= 0) {
            position = heightLeft - imgHeight;
            doc.addPage();
            doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight, undefined, 'FAST');
            heightLeft -= pageHeight;
        }

        // Remove temporary element
        document.body.removeChild(pdfContainer);
        
        // Save PDF with professional filename
        doc.save(`Elegets_Invoice_${invoiceNumber}.pdf`);
    }
  </script>
</body>
</html>